$(document).ready(function () {
  let data = $('#mensal-data-chart').data('value');
  let divId = $('#mensal-data-chart');

  if (data["labels"].length > 0) {
    divId.html('<canvas id="mensal-chart" style="width: 100%; height: 100%;"></canvas>');
    customMonthlyChart(data["labels"], data["data"]);
  }
  else{
    divId.html(
      '<p>Scan sem vulnerabilidades identificadas ou não executado</p>' +
      "<br><br>" +
      '<img src="/static/assets/img/teste-falha.png"'+
      'alt="Ícone de Teste Falha" style="margin-left: 120px">' +
      '<br><br' +
      '<canvas width="100%" height="95%"></canvas>'
    )
  }
});

function customMonthlyChart(labels, data, chart_type = "line") {
  let canvasId = "#mensal-chart";
  let ctx = $(canvasId);

  new Chart(ctx, {
    type: chart_type,
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Baixo',
          data: data["low"],
          backgroundColor: '#419582'
        },
        {
          label: 'Médio',
          data: data["medium"],
          backgroundColor: '#f3d877'
        },
        {
          label: 'Alto',
          data: data["high"],
          backgroundColor: '#efab39'
        },
        {
          label: 'Crítico',
          data: data["critical"],
          backgroundColor: '#cf3e3c'
        },
      ]
    },
    options: {
      plugins: {
        legend: {
          position: 'left',
          labels: {
            font: {
              weight: 'bold'
            }
          },
          padding: 20
        }
      },
    }
  });
}