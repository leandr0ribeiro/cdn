$(document).ready(function () {
    $('#changeConfirmationButton').on("click", function (event) {
        const tabela = $('#pentestTable').DataTable();
        const row = event.target.closest('tr');
        const rowData = tabela.row(row).data();
        rowData.status = { value: rowData.status, retest: true };

        const url = `/pentest/vulnerabilities/update/${rowData.id}`;
        const csrf_token = $('input[name="csrfmiddlewaretoken"]').val();
        const requestOptions = {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrf_token,
            },
            body: JSON.stringify(rowData),
        };

        fetch(url, requestOptions)
            .then(_ => {
                window.location.reload();
            })
            .catch(error => {
                console.error('Erro!', error);
            });
    });
});
